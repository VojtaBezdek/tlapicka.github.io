<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Tlapička.net</title><link>http://tlapicka.net/</link><description></description><atom:link href="http://tlapicka.net/feeds/io.rss.xml" rel="self"></atom:link><lastBuildDate>Mon, 28 Apr 2014 16:47:00 +0200</lastBuildDate><item><title>Výchozí kódování v Pythonu</title><link>http://tlapicka.net/vychozi-kodovani-v-pythonu.html</link><description>&lt;p&gt;Občas se mi stane, že spouštím v Linuxu Python skript vytvořený ve Windows.
Nejčastěji je to nějaká studentská práce, domácí úkol nebo něco podobného.
Většinou není co řešit a program si prostě spustím, ale občas dělá problém
diakritika v unicode řetězcích. Třeba:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="n"&gt;cislo&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;raw_input&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;u&amp;#39;napiš nějaké číslo&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;.....&lt;/span&gt;
&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;pokus.txt&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;w&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;Loď čeří kýlem vodu v úžině&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;.....&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Python se snaží v těchto situacích unicode řetězec konvertovat do
příslušné znakové sady. Problém je, že neví, která znaková sada je ta
"příslušná" a proto končí s chybovým hlášením:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="err"&gt;File &amp;quot;kodovani.py&amp;quot;, line 30, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;    f.write(cestina)&lt;/span&gt;
&lt;span class="go"&gt;UnicodeEncodeError: &amp;#39;ascii&amp;#39; codec can&amp;#39;t encode character u&amp;#39;\u010f&amp;#39;&lt;/span&gt;
&lt;span class="go"&gt;in position 2: ordinal not in range(128)&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="err"&gt;File &amp;quot;kodovani.py&amp;quot;, line 30, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Nejdřív to, co problémy nedělá: S tímto kódem problémy nejsou, protože kódování
pro standardní vstup/výstup je nastaveno na &lt;code&gt;UTF-8&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;default encoding: &amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;cestina&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;u&amp;#39;Loď v úžině&lt;/span&gt;&lt;span class="se"&gt;\n&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;&lt;/span&gt;

&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="n"&gt;cestina&lt;/span&gt;              &lt;span class="c"&gt;# tohle je OK&lt;/span&gt;
&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;cestina&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# tohle taky&lt;/span&gt;
&lt;span class="c"&gt;# prototože&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdin&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;stdout&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encoding&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Pokud je třeba nějak měnit kódování standardního vstupu/výstupu je to možné
udělat jednoduše přes proměnnou prostředí &lt;code&gt;PYTHONIOENCODING&lt;/code&gt;. Výstup potom
vypadá takto:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gp"&gt;$&lt;/span&gt; &lt;span class="nv"&gt;PYTHONIOENCODING&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;cp1250 ./kodovani.py
&lt;span class="go"&gt;default encoding:  utf-8&lt;/span&gt;
&lt;span class="go"&gt;Loï v úin&lt;/span&gt;

&lt;span class="go"&gt;Loï v úinì&lt;/span&gt;
&lt;span class="go"&gt;(&amp;#39;cp1250&amp;#39;, &amp;#39;cp1250&amp;#39;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Default encoding zůstalo stejné, změnilo se jen kódování standardního
vstupu/výstupu. Jak tedy nastavit &lt;code&gt;defaultencoding&lt;/code&gt;?. To se totiž projeví u
otevřených souborů nebo například u vestavěné funkce &lt;code&gt;raw_input()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Nejjednodušší je použít funkci &lt;code&gt;sys.setdefaultencoding()&lt;/code&gt;. Má to ale jeden malý
háček. Takto funkce je dostupná pouze při spuštění Pythonu. Dále se setkáme s
chybovým hlášením.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="err"&gt;File &amp;quot;kodovani.py&amp;quot;, line 12, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;span class="go"&gt;    sys.setdefaultencoding(&amp;quot;utf-8&amp;quot;)&lt;/span&gt;
&lt;span class="go"&gt;AttributeError: &amp;#39;module&amp;#39; object has no attribute &amp;#39;setdefaultencoding&amp;#39;&lt;/span&gt;
&lt;span class="gt"&gt;Traceback (most recent call last):&lt;/span&gt;
&lt;span class="err"&gt;File &amp;quot;kodovani.py&amp;quot;, line 12, in &amp;lt;module&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;První fígl je použít funkci &lt;code&gt;reload()&lt;/code&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="nb"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;  &lt;span class="c"&gt;# to enable `setdefaultencoding` again&lt;/span&gt;
&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;nebo&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="nb"&gt;reload&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Druhý fígl je spustit Python s parametrem &lt;code&gt;-S&lt;/code&gt;. Ten zakáže automatický import
modulu &lt;code&gt;site&lt;/code&gt;, který výchozí znakovou sadu nastavuje a funkci
&lt;code&gt;setdefaultencoding&lt;/code&gt; poté znepřístupní.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c"&gt;#!/usr/bin/python2.7 -S&lt;/span&gt;

&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;quot;utf-8&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;site&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Výše jsem uvedl řešení pro jeden konkrétní zdrojový kód. Pokud požadujeme
&lt;strong&gt;globální nastavení&lt;/strong&gt; stačí vytvořit soubor &lt;code&gt;sitecustomize.py&lt;/code&gt; a umístit ho
někam do &lt;code&gt;PYTHONPATH&lt;/code&gt; respektive do &lt;code&gt;sys.path&lt;/code&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;sys&lt;/span&gt;
&lt;span class="n"&gt;sys&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;setdefaultencoding&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s"&gt;&amp;#39;UTF-8&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;


&lt;dl&gt;
&lt;dt&gt;Odkazy:&lt;/dt&gt;
&lt;dd&gt;&lt;a href="http://stackoverflow.com/questions/11741574/how-to-set-the-default-encoding-to-utf-8-in-python"&gt;http://stackoverflow.com/questions/11741574/how-to-set-the-default-encoding-to-utf-8-in-python&lt;/a&gt;&lt;/dd&gt;
&lt;dd&gt;&lt;a href="http://stackoverflow.com/questions/2276200/changing-default-encoding-of-python"&gt;http://stackoverflow.com/questions/2276200/changing-default-encoding-of-python&lt;/a&gt;&lt;/dd&gt;
&lt;dd&gt;&lt;a href="http://stackoverflow.com/questions/7105441/how-to-set-default-encoding-in-python-setdefaultencoding-function-does-not-ex"&gt;http://stackoverflow.com/questions/7105441/how-to-set-default-encoding-in-python-setdefaultencoding-function-does-not-ex&lt;/a&gt;&lt;/dd&gt;
&lt;/dl&gt;</description><dc:creator xmlns:dc="http://purl.org/dc/elements/1.1/">Marek Nožka</dc:creator><pubDate>Mon, 28 Apr 2014 16:47:00 +0200</pubDate><guid>tag:tlapicka.net,2014-04-28:vychozi-kodovani-v-pythonu.html</guid><category>python</category><category>I/O</category></item></channel></rss>